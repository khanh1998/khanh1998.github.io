<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Postgres Collation | Khanh1998</title>
<meta name=keywords content="postgres,database"><meta name=description content="From my previous post, I realized that pattern matching operators (LIKE, ILIKE) do not utilize indexes. As I explored further, I came across the concept of collation and decided to take some notes in this post.
Encoding
Encoding maps human-readable characters to numbers so computers can understand them. Essentially, it assigns a unique number to each character. Common encodings include UTF-8 and ASCII.

ASCII: Represents 256 unique characters.
UTF-8: Represents 1,112,064 characters, covering almost all characters from any language.

Most modern programming languages, such as Go, natively support UTF-8. Unlike ASCII, which uses 1 byte per character, UTF-8 uses up to 4 bytes. Strings in programming languages are typically represented as byte arrays. In ASCII, the number of bytes corresponds to the number of characters. However, this is not true for UTF-8."><meta name=author content="Khanh Bui"><link rel=canonical href=https://khanh1998.github.io/posts/postgres-collation/><meta name=google-site-verification content="Siuz-KNzTaGnjWViVxoA0J6xLTJQtxwpsh9L7HHMNnA"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://khanh1998.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://khanh1998.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://khanh1998.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://khanh1998.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://khanh1998.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://khanh1998.github.io/posts/postgres-collation/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-Y0MCHJNHTB"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Y0MCHJNHTB")}</script><meta property="og:title" content="Postgres Collation"><meta property="og:description" content="From my previous post, I realized that pattern matching operators (LIKE, ILIKE) do not utilize indexes. As I explored further, I came across the concept of collation and decided to take some notes in this post.
Encoding
Encoding maps human-readable characters to numbers so computers can understand them. Essentially, it assigns a unique number to each character. Common encodings include UTF-8 and ASCII.

ASCII: Represents 256 unique characters.
UTF-8: Represents 1,112,064 characters, covering almost all characters from any language.

Most modern programming languages, such as Go, natively support UTF-8. Unlike ASCII, which uses 1 byte per character, UTF-8 uses up to 4 bytes. Strings in programming languages are typically represented as byte arrays. In ASCII, the number of bytes corresponds to the number of characters. However, this is not true for UTF-8."><meta property="og:type" content="article"><meta property="og:url" content="https://khanh1998.github.io/posts/postgres-collation/"><meta property="og:image" content="https://khanh1998.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-13T13:58:54+07:00"><meta property="article:modified_time" content="2024-11-13T13:58:54+07:00"><meta property="og:site_name" content="Khanh1998"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://khanh1998.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Postgres Collation"><meta name=twitter:description content="From my previous post, I realized that pattern matching operators (LIKE, ILIKE) do not utilize indexes. As I explored further, I came across the concept of collation and decided to take some notes in this post.
Encoding
Encoding maps human-readable characters to numbers so computers can understand them. Essentially, it assigns a unique number to each character. Common encodings include UTF-8 and ASCII.

ASCII: Represents 256 unique characters.
UTF-8: Represents 1,112,064 characters, covering almost all characters from any language.

Most modern programming languages, such as Go, natively support UTF-8. Unlike ASCII, which uses 1 byte per character, UTF-8 uses up to 4 bytes. Strings in programming languages are typically represented as byte arrays. In ASCII, the number of bytes corresponds to the number of characters. However, this is not true for UTF-8."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://khanh1998.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Postgres Collation","item":"https://khanh1998.github.io/posts/postgres-collation/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Postgres Collation","name":"Postgres Collation","description":"From my previous post, I realized that pattern matching operators (LIKE, ILIKE) do not utilize indexes. As I explored further, I came across the concept of collation and decided to take some notes in this post.\nEncoding Encoding maps human-readable characters to numbers so computers can understand them. Essentially, it assigns a unique number to each character. Common encodings include UTF-8 and ASCII.\nASCII: Represents 256 unique characters. UTF-8: Represents 1,112,064 characters, covering almost all characters from any language. Most modern programming languages, such as Go, natively support UTF-8. Unlike ASCII, which uses 1 byte per character, UTF-8 uses up to 4 bytes. Strings in programming languages are typically represented as byte arrays. In ASCII, the number of bytes corresponds to the number of characters. However, this is not true for UTF-8.\n","keywords":["postgres","database"],"articleBody":"From my previous post, I realized that pattern matching operators (LIKE, ILIKE) do not utilize indexes. As I explored further, I came across the concept of collation and decided to take some notes in this post.\nEncoding Encoding maps human-readable characters to numbers so computers can understand them. Essentially, it assigns a unique number to each character. Common encodings include UTF-8 and ASCII.\nASCII: Represents 256 unique characters. UTF-8: Represents 1,112,064 characters, covering almost all characters from any language. Most modern programming languages, such as Go, natively support UTF-8. Unlike ASCII, which uses 1 byte per character, UTF-8 uses up to 4 bytes. Strings in programming languages are typically represented as byte arrays. In ASCII, the number of bytes corresponds to the number of characters. However, this is not true for UTF-8.\nIn Go, iterating through a string’s byte array will produce incorrect results for non-ASCII characters. Instead, Go uses the rune type to represent characters.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // https://go.dev/blog/strings package main import ( \"fmt\" \"unicode/utf8\" ) func main() { const nihongo = \"日本語\" fmt.Printf(\"string = %s: byte = %d, rune(character) = %d\\n\", nihongo, len(nihongo), utf8.RuneCountInString(nihongo)) fmt.Println(\"The wrong way\") for i := 0; i \u003c len(nihongo); i++ { fmt.Printf(\"%#U starts at byte position %d\\n\", nihongo[i], i) } fmt.Println(\"The right way\") for index, runeValue := range nihongo { fmt.Printf(\"%#U starts at byte position %d\\n\", runeValue, index) } } Result:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 string = 日本語: byte = 9, rune(character) = 3 The wrong way U+00E6 'æ' starts at byte position 0 U+0097 starts at byte position 1 U+00A5 '¥' starts at byte position 2 U+00E6 'æ' starts at byte position 3 U+009C starts at byte position 4 U+00AC '¬' starts at byte position 5 U+00E8 'è' starts at byte position 6 U+00AA 'ª' starts at byte position 7 U+009E starts at byte position 8 The right way U+65E5 '日' starts at byte position 0 U+672C '本' starts at byte position 3 U+8A9E '語' starts at byte position 6 Collation Why Do We Need Collation? In programming, comparing two strings or characters often involves comparing their numeric representations from the encoding table. For example, in ASCII:\na (decimal 97) \u003e A (decimal 65). However, this approach does not work well for all languages. For instance, in the Vietnamese alphabet, a has variations like â, ă, á, à, ạ, and ả. Comparing â and b using UTF-8’s numeric representation gives:\nâ (decimal 226) \u003e b (decimal 98). But in Vietnamese, â \u003c b because â comes earlier in the alphabet.\nAdditionally, determining the lowercase of Á requires knowing the language and region. For example, in vi_VN.UTF-8, the lowercase of Á is á. Collation provides rules for such comparisons.\nVietnamese Alphabet with UTF-8 Decimal Code Points The table below shows the order of letters in the Vietnamese alphabet and their UTF-8 decimal codes. Notice how the order does not correspond to the numeric codes:\nLetter UTF-8 Decimal Code A 65 Á 193 À 192 Â 226 Ã 195 Ă 258 E 69 Ê 202 I 73 O 79 Ô 212 Õ 213 Ở 472 U 85 Ứ 372 Y 89 What Is Collation? Collation defines a set of rules for comparing strings, affecting operations like ordering, comparison operators (\u003c, \u003e), and pattern matching (LIKE, ILIKE, regex). It also influences capitalization functions like UPPER(), LOWER(), and INITCAP().\nCheck the default collation in PostgreSQL:\n1 2 3 4 5 6 7 8 9 10 11 postgres=# SHOW lc_collate; lc_collate ------------ en_US.utf8 (1 row) postgres=# SHOW lc_ctype; lc_ctype ------------ en_US.utf8 (1 row) In this case, the default collation is en_US.UTF-8. Without explicitly specifying a collation, PostgreSQL uses the default.\nWhy Don’t Pattern Matching Operators Use Indexes? Using locales other than C or POSIX impacts performance. Pattern matching operators like LIKE do not utilize ordinary indexes under non-C collations.\nThe drawback of using locales other than C or POSIX in PostgreSQL is its performance impact. It slows character handling and prevents ordinary indexes from being used by LIKE. For this reason use locales only if you actually need them. As a workaround to allow PostgreSQL to use indexes with LIKE clauses under a non-C locale, several custom operator classes exist. These allow the creation of an index that performs a strict character-by-character comparison, ignoring locale comparison rules. Refer to Section 11.10 for more information. Another approach is to create indexes using the C collation, as discussed in Section 23.2.\nPostgreSQL documentation Making Pattern Matching Operators Use Indexes There are three options:\nCollation C text_pattern_ops Trigram (pg_trgm) Let’s prepare some data for incoming demonstrations:\n1 2 3 4 5 6 7 8 9 10 11 12 13 CREATE TABLE grades (id serial PRIMARY KEY, g int, name text); CREATE INDEX g_index ON grades(g); INSERT INTO grades (g, name) SELECT random()*100, substring(md5(random()::text), 0, floor(random()*31)::int) FROM generate_series(0, 1000000); VACUUM (ANALYZE, VERBOSE, FULL); If you check the collation of the table’s columns and see it’s empty, it means the collation of the column is the default one:\n1 2 3 4 5 6 7 8 9 10 postgres=# \\d+ grades Table \"public.grades\" Column | Type | Collation | Nullable | Default | Storage | Compression | Stats target | Description --------+---------+-----------+----------+------------------------------------+----------+-------------+--------------+------------- id | integer | | not null | nextval('grades_id_seq'::regclass) | plain | | | g | integer | | | | plain | | | name | text | | | | extended | | | Indexes: \"grades_pkey\" PRIMARY KEY, btree (id) Access method: heap Collation C Collation C ignores locale rules and performs byte-wise comparisons using memcmp. It is faster but lacks localization.\nThe code snippet below shows how they handle collation in Postgres:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 int varstr_cmp\t(\tconst char * arg1, int len1, const char * arg2, int len2, Oid collid )\t{ int result; pg_locale_t mylocale; check_collation_set(collid); mylocale = pg_newlocale_from_collation(collid); if (mylocale-\u003ecollate_is_c) { result = memcmp(arg1, arg2, Min(len1, len2)); if ((result == 0) \u0026\u0026 (len1 != len2)) result = (len1 \u003c len2) ? -1 : 1; } else { /* * memcmp() can't tell us which of two unequal strings sorts first, * but it's a cheap way to tell if they're equal. Testing shows that * memcmp() followed by strcoll() is only trivially slower than * strcoll() by itself, so we don't lose much if this doesn't work out * very often, and if it does - for example, because there are many * equal strings in the input - then we win big by avoiding expensive * collation-aware comparisons. */ if (len1 == len2 \u0026\u0026 memcmp(arg1, arg2, len1) == 0) return 0; result = pg_strncoll(arg1, len1, arg2, len2, mylocale); /* Break tie if necessary. */ if (result == 0 \u0026\u0026 mylocale-\u003edeterministic) { result = memcmp(arg1, arg2, Min(len1, len2)); if ((result == 0) \u0026\u0026 (len1 != len2)) result = (len1 \u003c len2) ? -1 : 1; } } return result; } Since collate C compares the byte value of strings, its comparing result differs from other collations.\nIn the collation en_US.UTF-8, á is less than z:\n1 2 3 4 5 postgres=# select 'á' \u003e 'z'; ?column? ---------- f (1 row) However, in the collate C, á is greater than z, since byte value of á is greater than byte value of z.\n1 2 3 4 5 postgres=# select 'á' \u003e 'z' collate \"C\";; ?column? ---------- t (1 row) When using character capitalization functions like LOWER or UPPER, the C collation only supports characters in the a-z range. Characters outside this range remain unaffected:\n1 2 3 4 5 6 7 8 9 10 11 postgres=# select lower('É' collate \"C\"); lower ------- É (1 row) postgres=# select lower('É' collate \"en_US\"); lower ------- é (1 row) Additionally, the C collation does not validate Unicode code points. It simply performs byte-by-byte comparisons, which can lead to surprising results:\n1 2 3 4 5 6 7 8 9 10 11 postgres=# select ('A' \u003c E'\\u0378' collate \"C\"); ?column? ---------- t (1 row) postgres=# select ('A' \u003c E'\\u0378' collate \"en_US\"); ?column? ---------- f (1 row) Here, Unicode point U+0378 does not exist, but because the C collation performs a raw byte comparison, it treats it as valid and determines the result accordingly.\nReferences: 1\nExample Create an index with collation C:\n1 2 DROP INDEX IF EXISTS name_index1; CREATE INDEX name_index1 ON grades (name COLLATE \"C\"); Query with collation C:\n1 2 3 4 5 6 7 8 9 postgres=# explain analyze select * from grades where name like 'aba%' collate \"C\"; QUERY PLAN ------------------------------------------------------------------------------------------------------------------------ Index Scan using name_index1 on grades (cost=0.42..8.45 rows=90 width=23) (actual time=0.199..2.673 rows=229 loops=1) Index Cond: ((name \u003e= 'aba'::text) AND (name \u003c 'abb'::text)) Filter: (name ~~ 'aba%'::text COLLATE \"C\") Planning Time: 0.194 ms Execution Time: 2.721 ms (5 rows) It is important to add collate \"C\" into the query when you are using collate C indexes, otherwise, the operator like equal (=) will not utilize the index.\nText Pattern Ops 1 2 DROP INDEX IF EXISTS name_index2; CREATE INDEX name_index2 ON grades (name text_pattern_ops); Query:\n1 2 3 4 5 6 7 8 9 postgres=# explain analyze select * from grades where name like 'abc%'; QUERY PLAN ------------------------------------------------------------------------------------------------------------------------ Index Scan using name_index2 on grades (cost=0.42..8.45 rows=90 width=23) (actual time=0.066..0.317 rows=213 loops=1) Index Cond: ((name ~\u003e=~ 'abc'::text) AND (name ~\u003c~ 'abd'::text)) Filter: (name ~~ 'abc%'::text) Planning Time: 0.503 ms Execution Time: 0.343 ms (5 rows) Note on Collate C and Text Pattern Ops Note that you should also create an index with the default operator class if you want queries involving ordinary \u003c, \u003c=, \u003e, or \u003e= comparisons to use an index. Such queries cannot use the xxx_pattern_ops operator classes. (Ordinary equality comparisons can use these operator classes, however.) It is possible to create multiple indexes on the same column with different operator classes. If you do use the C locale, you do not need the xxx_pattern_ops operator classes, because an index with the default operator class is usable for pattern-matching queries in the C locale.\nIndexes Opclass That mean you should also create a normal index on the same column with the text_pattern_ops index, like this:\n1 CREATE INDEX name_index21 ON grades (name); The ordinary \u003c, \u003c=, \u003e, or \u003e= comparisons will (probably) utilize the normal index.\nTrigram Trigram indexing is suitable for non-left-anchored patterns like %abc% but adds overhead. Use it for advanced pattern matching:\n1 2 CREATE EXTENSION IF NOT EXISTS pg_trgm; CREATE INDEX name_trgm_idx ON grades USING gin (name gin_trgm_ops); Query:\n1 2 3 4 5 6 7 8 9 10 11 12 postgres=# explain analyze select * from grades where name like 'abd%'; QUERY PLAN -------------------------------------------------------------------------------------------------------------------------- Bitmap Heap Scan on grades (cost=52.70..382.61 rows=90 width=23) (actual time=0.986..7.877 rows=226 loops=1) Recheck Cond: (name ~~ 'abd%'::text) Rows Removed by Index Recheck: 5 Heap Blocks: exact=229 -\u003e Bitmap Index Scan on name_trgm_idx (cost=0.00..52.67 rows=90 width=0) (actual time=0.799..0.800 rows=231 loops=1) Index Cond: (name ~~ 'abd%'::text) Planning Time: 0.205 ms Execution Time: 7.940 ms (8 rows) References PostgreSQL Documentation - Locale Behavior PostgreSQL Documentation - Collation PostgreSQL Documentation - Indexes and Operator Classes https://stackoverflow.com/questions/68384666/b-tree-index-does-not-seem-to-be-used/68385039#68385039 https://dba.stackexchange.com/questions/53811/why-would-you-index-text-pattern-ops-on-a-text-column ","wordCount":"1903","inLanguage":"en","image":"https://khanh1998.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-11-13T13:58:54+07:00","dateModified":"2024-11-13T13:58:54+07:00","author":{"@type":"Person","name":"Khanh Bui"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://khanh1998.github.io/posts/postgres-collation/"},"publisher":{"@type":"Organization","name":"Khanh1998","logo":{"@type":"ImageObject","url":"https://khanh1998.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://khanh1998.github.io/ accesskey=h title="Khanh1998 (Alt + H)"><img src=https://khanh1998.github.io/favicon.ico alt aria-label=logo height=32>Khanh1998</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://khanh1998.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://khanh1998.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://khanh1998.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://khanh1998.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://khanh1998.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Postgres Collation</h1><div class=post-meta><span title='2024-11-13 13:58:54 +0700 +07'>November 13, 2024</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;1903 words&nbsp;·&nbsp;Khanh Bui&nbsp;|&nbsp;<a href=https://github.com/khanh1998/khanh1998.github.io/blob/main/content/posts/postgres-collation.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#why-do-we-need-collation>Why Do We Need Collation?</a><ul><li><a href=#vietnamese-alphabet-with-utf-8-decimal-code-points>Vietnamese Alphabet with UTF-8 Decimal Code Points</a></li><li><a href=#what-is-collation>What Is Collation?</a></li></ul></li><li><a href=#why-dont-pattern-matching-operators-use-indexes>Why Don’t Pattern Matching Operators Use Indexes?</a></li><li><a href=#making-pattern-matching-operators-use-indexes>Making Pattern Matching Operators Use Indexes</a><ul><li><a href=#collation-c>Collation <code>C</code></a></li><li><a href=#text-pattern-ops>Text Pattern Ops</a></li><li><a href=#note-on-collate-c-and-text-pattern-ops>Note on Collate C and Text Pattern Ops</a></li><li><a href=#trigram>Trigram</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>From my <a href=https://khanh1998.github.io/posts/which-operator-is-faster-like-vs-equal/>previous post</a>, I realized that pattern matching operators (<code>LIKE</code>, <code>ILIKE</code>) do not utilize indexes. As I explored further, I came across the concept of collation and decided to take some notes in this post.</p><h1 id=encoding>Encoding<a hidden class=anchor aria-hidden=true href=#encoding>#</a></h1><p>Encoding maps human-readable characters to numbers so computers can understand them. Essentially, it assigns a unique number to each character. Common encodings include UTF-8 and ASCII.</p><ul><li><strong>ASCII</strong>: Represents 256 unique characters.</li><li><strong>UTF-8</strong>: Represents 1,112,064 characters, covering almost all characters from any language.</li></ul><p>Most modern programming languages, such as Go, natively support UTF-8. Unlike ASCII, which uses 1 byte per character, UTF-8 uses up to 4 bytes. Strings in programming languages are typically represented as byte arrays. In ASCII, the number of bytes corresponds to the number of characters. However, this is not true for UTF-8.</p><p>In Go, iterating through a string’s byte array will produce incorrect results for non-ASCII characters. Instead, Go uses the <code>rune</code> type to represent characters.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18>18</a>
</span><span class=lnt id=hl-0-19><a class=lnlinks href=#hl-0-19>19</a>
</span><span class=lnt id=hl-0-20><a class=lnlinks href=#hl-0-20>20</a>
</span><span class=lnt id=hl-0-21><a class=lnlinks href=#hl-0-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// https://go.dev/blog/strings
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;unicode/utf8&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>const</span> <span class=nx>nihongo</span> <span class=p>=</span> <span class=s>&#34;日本語&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;string = %s: byte = %d, rune(character) = %d\n&#34;</span><span class=p>,</span> <span class=nx>nihongo</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>nihongo</span><span class=p>),</span> <span class=nx>utf8</span><span class=p>.</span><span class=nf>RuneCountInString</span><span class=p>(</span><span class=nx>nihongo</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;The wrong way&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>nihongo</span><span class=p>);</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%#U starts at byte position %d\n&#34;</span><span class=p>,</span> <span class=nx>nihongo</span><span class=p>[</span><span class=nx>i</span><span class=p>],</span> <span class=nx>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;The right way&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>index</span><span class=p>,</span> <span class=nx>runeValue</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>nihongo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%#U starts at byte position %d\n&#34;</span><span class=p>,</span> <span class=nx>runeValue</span><span class=p>,</span> <span class=nx>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Result:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>string = 日本語: byte = 9, rune(character) = 3
</span></span><span class=line><span class=cl>The wrong way
</span></span><span class=line><span class=cl>U+00E6 &#39;æ&#39; starts at byte position 0
</span></span><span class=line><span class=cl>U+0097 starts at byte position 1
</span></span><span class=line><span class=cl>U+00A5 &#39;¥&#39; starts at byte position 2
</span></span><span class=line><span class=cl>U+00E6 &#39;æ&#39; starts at byte position 3
</span></span><span class=line><span class=cl>U+009C starts at byte position 4
</span></span><span class=line><span class=cl>U+00AC &#39;¬&#39; starts at byte position 5
</span></span><span class=line><span class=cl>U+00E8 &#39;è&#39; starts at byte position 6
</span></span><span class=line><span class=cl>U+00AA &#39;ª&#39; starts at byte position 7
</span></span><span class=line><span class=cl>U+009E starts at byte position 8
</span></span><span class=line><span class=cl>The right way
</span></span><span class=line><span class=cl>U+65E5 &#39;日&#39; starts at byte position 0
</span></span><span class=line><span class=cl>U+672C &#39;本&#39; starts at byte position 3
</span></span><span class=line><span class=cl>U+8A9E &#39;語&#39; starts at byte position 6
</span></span></code></pre></td></tr></table></div></div><h1 id=collation>Collation<a hidden class=anchor aria-hidden=true href=#collation>#</a></h1><h2 id=why-do-we-need-collation>Why Do We Need Collation?<a hidden class=anchor aria-hidden=true href=#why-do-we-need-collation>#</a></h2><p>In programming, comparing two strings or characters often involves comparing their numeric representations from the encoding table. For example, in ASCII:</p><ul><li><code>a</code> (decimal 97) > <code>A</code> (decimal 65).</li></ul><p>However, this approach does not work well for all languages. For instance, in the Vietnamese alphabet, <code>a</code> has variations like <code>â</code>, <code>ă</code>, <code>á</code>, <code>à</code>, <code>ạ</code>, and <code>ả</code>. Comparing <code>â</code> and <code>b</code> using UTF-8’s numeric representation gives:</p><ul><li><code>â</code> (decimal 226) > <code>b</code> (decimal 98).</li></ul><p>But in Vietnamese, <code>â</code> &lt; <code>b</code> because <code>â</code> comes earlier in the alphabet.</p><p>Additionally, determining the lowercase of <code>Á</code> requires knowing the language and region. For example, in <code>vi_VN.UTF-8</code>, the lowercase of <code>Á</code> is <code>á</code>. Collation provides rules for such comparisons.</p><h3 id=vietnamese-alphabet-with-utf-8-decimal-code-points>Vietnamese Alphabet with UTF-8 Decimal Code Points<a hidden class=anchor aria-hidden=true href=#vietnamese-alphabet-with-utf-8-decimal-code-points>#</a></h3><p>The table below shows the order of letters in the Vietnamese alphabet and their UTF-8 decimal codes. Notice how the order does not correspond to the numeric codes:</p><table><thead><tr><th>Letter</th><th>UTF-8 Decimal Code</th></tr></thead><tbody><tr><td>A</td><td>65</td></tr><tr><td>Á</td><td>193</td></tr><tr><td>À</td><td>192</td></tr><tr><td>Â</td><td>226</td></tr><tr><td>Ã</td><td>195</td></tr><tr><td>Ă</td><td>258</td></tr><tr><td>E</td><td>69</td></tr><tr><td>Ê</td><td>202</td></tr><tr><td>I</td><td>73</td></tr><tr><td>O</td><td>79</td></tr><tr><td>Ô</td><td>212</td></tr><tr><td>Õ</td><td>213</td></tr><tr><td>Ở</td><td>472</td></tr><tr><td>U</td><td>85</td></tr><tr><td>Ứ</td><td>372</td></tr><tr><td>Y</td><td>89</td></tr></tbody></table><h3 id=what-is-collation>What Is Collation?<a hidden class=anchor aria-hidden=true href=#what-is-collation>#</a></h3><p>Collation defines a set of rules for comparing strings, affecting operations like ordering, comparison operators (<code>&lt;</code>, <code>></code>), and pattern matching (<code>LIKE</code>, <code>ILIKE</code>, regex). It also influences capitalization functions like <code>UPPER()</code>, <code>LOWER()</code>, and <code>INITCAP()</code>.</p><p>Check the default collation in PostgreSQL:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>SHOW</span><span class=w> </span><span class=n>lc_collate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>lc_collate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=n>en_US</span><span class=p>.</span><span class=n>utf8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>SHOW</span><span class=w> </span><span class=n>lc_ctype</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>lc_ctype</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=n>en_US</span><span class=p>.</span><span class=n>utf8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>In this case, the default collation is <code>en_US.UTF-8</code>. Without explicitly specifying a collation, PostgreSQL uses the default.</p><h2 id=why-dont-pattern-matching-operators-use-indexes>Why Don’t Pattern Matching Operators Use Indexes?<a hidden class=anchor aria-hidden=true href=#why-dont-pattern-matching-operators-use-indexes>#</a></h2><p>Using locales other than <code>C</code> or <code>POSIX</code> impacts performance. Pattern matching operators like <code>LIKE</code> do not utilize ordinary indexes under non-C collations.</p><blockquote><p>The drawback of using locales other than C or POSIX in PostgreSQL is its performance impact. It slows character handling and prevents ordinary indexes from being used by LIKE. For this reason use locales only if you actually need them.
As a workaround to allow PostgreSQL to use indexes with LIKE clauses under a non-C locale, several custom operator classes exist. These allow the creation of an index that performs a strict character-by-character comparison, ignoring locale comparison rules. Refer to Section 11.10 for more information. Another approach is to create indexes using the C collation, as discussed in Section 23.2.</p><ul><li><a href=https://www.postgresql.org/docs/current/locale.html#LOCALE-BEHAVIOR>PostgreSQL documentation</a></li></ul></blockquote><h2 id=making-pattern-matching-operators-use-indexes>Making Pattern Matching Operators Use Indexes<a hidden class=anchor aria-hidden=true href=#making-pattern-matching-operators-use-indexes>#</a></h2><p>There are three options:</p><ol><li>Collation <code>C</code></li><li><code>text_pattern_ops</code></li><li>Trigram (<code>pg_trgm</code>)</li></ol><p>Let&rsquo;s prepare some data for incoming demonstrations:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>grades</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=nb>serial</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                       </span><span class=k>g</span><span class=w> </span><span class=nb>int</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=nb>text</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>g_index</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>grades</span><span class=p>(</span><span class=k>g</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>grades</span><span class=w> </span><span class=p>(</span><span class=k>g</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>random</span><span class=p>()</span><span class=o>*</span><span class=mi>100</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>substring</span><span class=p>(</span><span class=n>md5</span><span class=p>(</span><span class=n>random</span><span class=p>()::</span><span class=nb>text</span><span class=p>),</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>floor</span><span class=p>(</span><span class=n>random</span><span class=p>()</span><span class=o>*</span><span class=mi>31</span><span class=p>)::</span><span class=nb>int</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>generate_series</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>1000000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>VACUUM</span><span class=w> </span><span class=p>(</span><span class=k>ANALYZE</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>VERBOSE</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>FULL</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>If you check the collation of the table&rsquo;s columns and see it&rsquo;s empty, it means the collation of the column is the default one:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=err>\</span><span class=n>d</span><span class=o>+</span><span class=w> </span><span class=n>grades</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                                       </span><span class=k>Table</span><span class=w> </span><span class=s2>&#34;public.grades&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=k>Column</span><span class=w> </span><span class=o>|</span><span class=w>  </span><span class=k>Type</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=k>Collation</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>Nullable</span><span class=w> </span><span class=o>|</span><span class=w>              </span><span class=k>Default</span><span class=w>               </span><span class=o>|</span><span class=w> </span><span class=k>Storage</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Compression</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Stats</span><span class=w> </span><span class=n>target</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Description</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--------+---------+-----------+----------+------------------------------------+----------+-------------+--------------+-------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=n>id</span><span class=w>     </span><span class=o>|</span><span class=w> </span><span class=nb>integer</span><span class=w> </span><span class=o>|</span><span class=w>           </span><span class=o>|</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>nextval</span><span class=p>(</span><span class=s1>&#39;grades_id_seq&#39;</span><span class=p>::</span><span class=n>regclass</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>plain</span><span class=w>    </span><span class=o>|</span><span class=w>             </span><span class=o>|</span><span class=w>              </span><span class=o>|</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=k>g</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=nb>integer</span><span class=w> </span><span class=o>|</span><span class=w>           </span><span class=o>|</span><span class=w>          </span><span class=o>|</span><span class=w>                                    </span><span class=o>|</span><span class=w> </span><span class=n>plain</span><span class=w>    </span><span class=o>|</span><span class=w>             </span><span class=o>|</span><span class=w>              </span><span class=o>|</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>name</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=nb>text</span><span class=w>    </span><span class=o>|</span><span class=w>           </span><span class=o>|</span><span class=w>          </span><span class=o>|</span><span class=w>                                    </span><span class=o>|</span><span class=w> </span><span class=n>extended</span><span class=w> </span><span class=o>|</span><span class=w>             </span><span class=o>|</span><span class=w>              </span><span class=o>|</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Indexes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;grades_pkey&#34;</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w> </span><span class=n>btree</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>Access</span><span class=w> </span><span class=k>method</span><span class=p>:</span><span class=w> </span><span class=n>heap</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=collation-c>Collation <code>C</code><a hidden class=anchor aria-hidden=true href=#collation-c>#</a></h3><p>Collation <code>C</code> ignores locale rules and performs byte-wise comparisons using <code>memcmp</code>. It is faster but lacks localization.</p><p>The <a href=https://doxygen.postgresql.org/varlena_8c.html#a418147ce1a2a44279466b4a24ddeb964>code snippet</a> below shows how they handle collation in Postgres:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25>25</a>
</span><span class=lnt id=hl-5-26><a class=lnlinks href=#hl-5-26>26</a>
</span><span class=lnt id=hl-5-27><a class=lnlinks href=#hl-5-27>27</a>
</span><span class=lnt id=hl-5-28><a class=lnlinks href=#hl-5-28>28</a>
</span><span class=lnt id=hl-5-29><a class=lnlinks href=#hl-5-29>29</a>
</span><span class=lnt id=hl-5-30><a class=lnlinks href=#hl-5-30>30</a>
</span><span class=lnt id=hl-5-31><a class=lnlinks href=#hl-5-31>31</a>
</span><span class=lnt id=hl-5-32><a class=lnlinks href=#hl-5-32>32</a>
</span><span class=lnt id=hl-5-33><a class=lnlinks href=#hl-5-33>33</a>
</span><span class=lnt id=hl-5-34><a class=lnlinks href=#hl-5-34>34</a>
</span><span class=lnt id=hl-5-35><a class=lnlinks href=#hl-5-35>35</a>
</span><span class=lnt id=hl-5-36><a class=lnlinks href=#hl-5-36>36</a>
</span><span class=lnt id=hl-5-37><a class=lnlinks href=#hl-5-37>37</a>
</span><span class=lnt id=hl-5-38><a class=lnlinks href=#hl-5-38>38</a>
</span><span class=lnt id=hl-5-39><a class=lnlinks href=#hl-5-39>39</a>
</span><span class=lnt id=hl-5-40><a class=lnlinks href=#hl-5-40>40</a>
</span><span class=lnt id=hl-5-41><a class=lnlinks href=#hl-5-41>41</a>
</span><span class=lnt id=hl-5-42><a class=lnlinks href=#hl-5-42>42</a>
</span><span class=lnt id=hl-5-43><a class=lnlinks href=#hl-5-43>43</a>
</span><span class=lnt id=hl-5-44><a class=lnlinks href=#hl-5-44>44</a>
</span><span class=lnt id=hl-5-45><a class=lnlinks href=#hl-5-45>45</a>
</span><span class=lnt id=hl-5-46><a class=lnlinks href=#hl-5-46>46</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>varstr_cmp</span>	<span class=p>(</span>	<span class=k>const</span> <span class=kt>char</span> <span class=o>*</span> 	<span class=n>arg1</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> 	<span class=n>len1</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span> 	<span class=n>arg2</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> 	<span class=n>len2</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=n>Oid</span> 	<span class=n>collid</span> 
</span></span><span class=line><span class=cl><span class=p>)</span>	<span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span>         <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>pg_locale_t</span> <span class=n>mylocale</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=nf>check_collation_set</span><span class=p>(</span><span class=n>collid</span><span class=p>);</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=n>mylocale</span> <span class=o>=</span> <span class=nf>pg_newlocale_from_collation</span><span class=p>(</span><span class=n>collid</span><span class=p>);</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>mylocale</span><span class=o>-&gt;</span><span class=n>collate_is_c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=nf>memcmp</span><span class=p>(</span><span class=n>arg1</span><span class=p>,</span> <span class=n>arg2</span><span class=p>,</span> <span class=nf>Min</span><span class=p>(</span><span class=n>len1</span><span class=p>,</span> <span class=n>len2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>((</span><span class=n>result</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>len1</span> <span class=o>!=</span> <span class=n>len2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=p>(</span><span class=n>len1</span> <span class=o>&lt;</span> <span class=n>len2</span><span class=p>)</span> <span class=o>?</span> <span class=o>-</span><span class=mi>1</span> <span class=o>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>         * memcmp() can&#39;t tell us which of two unequal strings sorts first,
</span></span></span><span class=line><span class=cl><span class=cm>         * but it&#39;s a cheap way to tell if they&#39;re equal.  Testing shows that
</span></span></span><span class=line><span class=cl><span class=cm>         * memcmp() followed by strcoll() is only trivially slower than
</span></span></span><span class=line><span class=cl><span class=cm>         * strcoll() by itself, so we don&#39;t lose much if this doesn&#39;t work out
</span></span></span><span class=line><span class=cl><span class=cm>         * very often, and if it does - for example, because there are many
</span></span></span><span class=line><span class=cl><span class=cm>         * equal strings in the input - then we win big by avoiding expensive
</span></span></span><span class=line><span class=cl><span class=cm>         * collation-aware comparisons.
</span></span></span><span class=line><span class=cl><span class=cm>         */</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>len1</span> <span class=o>==</span> <span class=n>len2</span> <span class=o>&amp;&amp;</span> <span class=nf>memcmp</span><span class=p>(</span><span class=n>arg1</span><span class=p>,</span> <span class=n>arg2</span><span class=p>,</span> <span class=n>len1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=nf>pg_strncoll</span><span class=p>(</span><span class=n>arg1</span><span class=p>,</span> <span class=n>len1</span><span class=p>,</span> <span class=n>arg2</span><span class=p>,</span> <span class=n>len2</span><span class=p>,</span> <span class=n>mylocale</span><span class=p>);</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=cm>/* Break tie if necessary. */</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>result</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>mylocale</span><span class=o>-&gt;</span><span class=n>deterministic</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=nf>memcmp</span><span class=p>(</span><span class=n>arg1</span><span class=p>,</span> <span class=n>arg2</span><span class=p>,</span> <span class=nf>Min</span><span class=p>(</span><span class=n>len1</span><span class=p>,</span> <span class=n>len2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>((</span><span class=n>result</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>len1</span> <span class=o>!=</span> <span class=n>len2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span> <span class=o>=</span> <span class=p>(</span><span class=n>len1</span> <span class=o>&lt;</span> <span class=n>len2</span><span class=p>)</span> <span class=o>?</span> <span class=o>-</span><span class=mi>1</span> <span class=o>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Since collate C compares the byte value of strings, its comparing result differs from other collations.</p><p>In the collation <code>en_US.UTF-8</code>, <code>á</code> is less than <code>z</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2>2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3>3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4>4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=s1>&#39;á&#39;</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=s1>&#39;z&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=o>?</span><span class=k>column</span><span class=o>?</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>----------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=n>f</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>However, in the collate C, <code>á</code> is greater than <code>z</code>, since byte value of <code>á</code> is greater than byte value of <code>z</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1>1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2>2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3>3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4>4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=s1>&#39;á&#39;</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=s1>&#39;z&#39;</span><span class=w> </span><span class=k>collate</span><span class=w> </span><span class=s2>&#34;C&#34;</span><span class=p>;;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=o>?</span><span class=k>column</span><span class=o>?</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>----------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=n>t</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>When using character capitalization functions like <code>LOWER</code> or <code>UPPER</code>, the C collation only supports characters in the a-z range. Characters outside this range remain unaffected:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>lower</span><span class=p>(</span><span class=s1>&#39;É&#39;</span><span class=w> </span><span class=k>collate</span><span class=w> </span><span class=s2>&#34;C&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=k>lower</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=err>É</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>lower</span><span class=p>(</span><span class=s1>&#39;É&#39;</span><span class=w> </span><span class=k>collate</span><span class=w> </span><span class=s2>&#34;en_US&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=k>lower</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=err>é</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Additionally, the C collation does not validate Unicode code points. It simply performs byte-by-byte comparisons, which can lead to surprising results:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>E</span><span class=s1>&#39;\u0378&#39;</span><span class=w> </span><span class=k>collate</span><span class=w> </span><span class=s2>&#34;C&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=o>?</span><span class=k>column</span><span class=o>?</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>----------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=n>t</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>E</span><span class=s1>&#39;\u0378&#39;</span><span class=w> </span><span class=k>collate</span><span class=w> </span><span class=s2>&#34;en_US&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=o>?</span><span class=k>column</span><span class=o>?</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>----------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=n>f</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Here, Unicode point <code>U+0378</code> does not exist, but because the C collation performs a raw byte comparison, it treats it as valid and determines the result accordingly.</p><p>References:
<a href=https://dba.stackexchange.com/a/241018>1</a></p><h4 id=example>Example<a hidden class=anchor aria-hidden=true href=#example>#</a></h4><p>Create an index with collation <code>C</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>name_index1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>name_index1</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>grades</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=k>COLLATE</span><span class=w> </span><span class=s2>&#34;C&#34;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Query with collation <code>C</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1>1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2>2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3>3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4>4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5>5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6>6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7>7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8>8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>explain</span><span class=w> </span><span class=k>analyze</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>grades</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;aba%&#39;</span><span class=w> </span><span class=k>collate</span><span class=w> </span><span class=s2>&#34;C&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                                       </span><span class=n>QUERY</span><span class=w> </span><span class=n>PLAN</span><span class=w>                                                       
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>------------------------------------------------------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=k>Index</span><span class=w> </span><span class=n>Scan</span><span class=w> </span><span class=k>using</span><span class=w> </span><span class=n>name_index1</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>grades</span><span class=w>  </span><span class=p>(</span><span class=n>cost</span><span class=o>=</span><span class=mi>0</span><span class=p>.</span><span class=mi>42</span><span class=p>..</span><span class=mi>8</span><span class=p>.</span><span class=mi>45</span><span class=w> </span><span class=k>rows</span><span class=o>=</span><span class=mi>90</span><span class=w> </span><span class=n>width</span><span class=o>=</span><span class=mi>23</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>actual</span><span class=w> </span><span class=n>time</span><span class=o>=</span><span class=mi>0</span><span class=p>.</span><span class=mi>199</span><span class=p>..</span><span class=mi>2</span><span class=p>.</span><span class=mi>673</span><span class=w> </span><span class=k>rows</span><span class=o>=</span><span class=mi>229</span><span class=w> </span><span class=n>loops</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=k>Index</span><span class=w> </span><span class=n>Cond</span><span class=p>:</span><span class=w> </span><span class=p>((</span><span class=n>name</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=s1>&#39;aba&#39;</span><span class=p>::</span><span class=nb>text</span><span class=p>)</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=s1>&#39;abb&#39;</span><span class=p>::</span><span class=nb>text</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>Filter</span><span class=p>:</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>~~</span><span class=w> </span><span class=s1>&#39;aba%&#39;</span><span class=p>::</span><span class=nb>text</span><span class=w> </span><span class=k>COLLATE</span><span class=w> </span><span class=s2>&#34;C&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>Planning</span><span class=w> </span><span class=n>Time</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>.</span><span class=mi>194</span><span class=w> </span><span class=n>ms</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>Execution</span><span class=w> </span><span class=n>Time</span><span class=p>:</span><span class=w> </span><span class=mi>2</span><span class=p>.</span><span class=mi>721</span><span class=w> </span><span class=n>ms</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=mi>5</span><span class=w> </span><span class=k>rows</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>It is important to add <code>collate "C"</code> into the query when you are using collate C indexes, otherwise, the operator like equal (<code>=</code>) will not utilize the index.</p><h3 id=text-pattern-ops>Text Pattern Ops<a hidden class=anchor aria-hidden=true href=#text-pattern-ops>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>name_index2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>name_index2</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>grades</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=n>text_pattern_ops</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Query:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3>3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4>4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5>5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6>6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7>7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8>8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>explain</span><span class=w> </span><span class=k>analyze</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>grades</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;abc%&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                                       </span><span class=n>QUERY</span><span class=w> </span><span class=n>PLAN</span><span class=w>                                                       
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>------------------------------------------------------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=k>Index</span><span class=w> </span><span class=n>Scan</span><span class=w> </span><span class=k>using</span><span class=w> </span><span class=n>name_index2</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>grades</span><span class=w>  </span><span class=p>(</span><span class=n>cost</span><span class=o>=</span><span class=mi>0</span><span class=p>.</span><span class=mi>42</span><span class=p>..</span><span class=mi>8</span><span class=p>.</span><span class=mi>45</span><span class=w> </span><span class=k>rows</span><span class=o>=</span><span class=mi>90</span><span class=w> </span><span class=n>width</span><span class=o>=</span><span class=mi>23</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>actual</span><span class=w> </span><span class=n>time</span><span class=o>=</span><span class=mi>0</span><span class=p>.</span><span class=mi>066</span><span class=p>..</span><span class=mi>0</span><span class=p>.</span><span class=mi>317</span><span class=w> </span><span class=k>rows</span><span class=o>=</span><span class=mi>213</span><span class=w> </span><span class=n>loops</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=k>Index</span><span class=w> </span><span class=n>Cond</span><span class=p>:</span><span class=w> </span><span class=p>((</span><span class=n>name</span><span class=w> </span><span class=o>~&gt;=~</span><span class=w> </span><span class=s1>&#39;abc&#39;</span><span class=p>::</span><span class=nb>text</span><span class=p>)</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>~&lt;~</span><span class=w> </span><span class=s1>&#39;abd&#39;</span><span class=p>::</span><span class=nb>text</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>Filter</span><span class=p>:</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>~~</span><span class=w> </span><span class=s1>&#39;abc%&#39;</span><span class=p>::</span><span class=nb>text</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>Planning</span><span class=w> </span><span class=n>Time</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>.</span><span class=mi>503</span><span class=w> </span><span class=n>ms</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>Execution</span><span class=w> </span><span class=n>Time</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>.</span><span class=mi>343</span><span class=w> </span><span class=n>ms</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=mi>5</span><span class=w> </span><span class=k>rows</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=note-on-collate-c-and-text-pattern-ops>Note on Collate C and Text Pattern Ops<a hidden class=anchor aria-hidden=true href=#note-on-collate-c-and-text-pattern-ops>#</a></h3><blockquote><p>Note that you should also create an index with the default operator class if you want queries involving ordinary &lt;, &lt;=, >, or >= comparisons to use an index. Such queries cannot use the xxx_pattern_ops operator classes. (Ordinary equality comparisons can use these operator classes, however.) It is possible to create multiple indexes on the same column with different operator classes. If you do use the C locale, you do not need the xxx_pattern_ops operator classes, because an index with the default operator class is usable for pattern-matching queries in the C locale.</p><ul><li><a href=https://www.postgresql.org/docs/current/indexes-opclass.html>Indexes Opclass</a></li></ul></blockquote><p>That mean you should also create a normal index on the same column with the text_pattern_ops index, like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>name_index21</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>grades</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>The ordinary &lt;, &lt;=, >, or >= comparisons will (probably) utilize the normal index.</p><h3 id=trigram>Trigram<a hidden class=anchor aria-hidden=true href=#trigram>#</a></h3><p>Trigram indexing is suitable for non-left-anchored patterns like <code>%abc%</code> but adds overhead. Use it for advanced pattern matching:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=n>EXTENSION</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>pg_trgm</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>name_trgm_idx</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>grades</span><span class=w> </span><span class=k>USING</span><span class=w> </span><span class=n>gin</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=n>gin_trgm_ops</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Query:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>explain</span><span class=w> </span><span class=k>analyze</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>grades</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;abd%&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                                        </span><span class=n>QUERY</span><span class=w> </span><span class=n>PLAN</span><span class=w>                                                        
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--------------------------------------------------------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=n>Bitmap</span><span class=w> </span><span class=n>Heap</span><span class=w> </span><span class=n>Scan</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>grades</span><span class=w>  </span><span class=p>(</span><span class=n>cost</span><span class=o>=</span><span class=mi>52</span><span class=p>.</span><span class=mi>70</span><span class=p>..</span><span class=mi>382</span><span class=p>.</span><span class=mi>61</span><span class=w> </span><span class=k>rows</span><span class=o>=</span><span class=mi>90</span><span class=w> </span><span class=n>width</span><span class=o>=</span><span class=mi>23</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>actual</span><span class=w> </span><span class=n>time</span><span class=o>=</span><span class=mi>0</span><span class=p>.</span><span class=mi>986</span><span class=p>..</span><span class=mi>7</span><span class=p>.</span><span class=mi>877</span><span class=w> </span><span class=k>rows</span><span class=o>=</span><span class=mi>226</span><span class=w> </span><span class=n>loops</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=k>Recheck</span><span class=w> </span><span class=n>Cond</span><span class=p>:</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>~~</span><span class=w> </span><span class=s1>&#39;abd%&#39;</span><span class=p>::</span><span class=nb>text</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=k>Rows</span><span class=w> </span><span class=n>Removed</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=k>Index</span><span class=w> </span><span class=k>Recheck</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>Heap</span><span class=w> </span><span class=n>Blocks</span><span class=p>:</span><span class=w> </span><span class=n>exact</span><span class=o>=</span><span class=mi>229</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>-&gt;</span><span class=w>  </span><span class=n>Bitmap</span><span class=w> </span><span class=k>Index</span><span class=w> </span><span class=n>Scan</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>name_trgm_idx</span><span class=w>  </span><span class=p>(</span><span class=n>cost</span><span class=o>=</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=p>..</span><span class=mi>52</span><span class=p>.</span><span class=mi>67</span><span class=w> </span><span class=k>rows</span><span class=o>=</span><span class=mi>90</span><span class=w> </span><span class=n>width</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>actual</span><span class=w> </span><span class=n>time</span><span class=o>=</span><span class=mi>0</span><span class=p>.</span><span class=mi>799</span><span class=p>..</span><span class=mi>0</span><span class=p>.</span><span class=mi>800</span><span class=w> </span><span class=k>rows</span><span class=o>=</span><span class=mi>231</span><span class=w> </span><span class=n>loops</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=k>Index</span><span class=w> </span><span class=n>Cond</span><span class=p>:</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>~~</span><span class=w> </span><span class=s1>&#39;abd%&#39;</span><span class=p>::</span><span class=nb>text</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>Planning</span><span class=w> </span><span class=n>Time</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>.</span><span class=mi>205</span><span class=w> </span><span class=n>ms</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>Execution</span><span class=w> </span><span class=n>Time</span><span class=p>:</span><span class=w> </span><span class=mi>7</span><span class=p>.</span><span class=mi>940</span><span class=w> </span><span class=n>ms</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=mi>8</span><span class=w> </span><span class=k>rows</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h1 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h1><ul><li><a href=https://www.postgresql.org/docs/current/locale.html>PostgreSQL Documentation - Locale Behavior</a></li><li><a href=https://www.postgresql.org/docs/current/collation.html>PostgreSQL Documentation - Collation</a></li><li><a href=https://www.postgresql.org/docs/current/indexes-opclass.html>PostgreSQL Documentation - Indexes and Operator Classes</a></li><li><a href=https://stackoverflow.com/questions/68384666/b-tree-index-does-not-seem-to-be-used/68385039#68385039>https://stackoverflow.com/questions/68384666/b-tree-index-does-not-seem-to-be-used/68385039#68385039</a></li><li><a href=https://dba.stackexchange.com/questions/53811/why-would-you-index-text-pattern-ops-on-a-text-column>https://dba.stackexchange.com/questions/53811/why-would-you-index-text-pattern-ops-on-a-text-column</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://khanh1998.github.io/tags/postgres/>Postgres</a></li><li><a href=https://khanh1998.github.io/tags/database/>Database</a></li></ul><nav class=paginav><a class=prev href=https://khanh1998.github.io/posts/postgres-advisory-locks/><span class=title>« Prev</span><br><span>Postgres Advisory Locks</span>
</a><a class=next href=https://khanh1998.github.io/posts/listen-on-localhost-8080-meaning/><span class=title>Next »</span><br><span>What does it mean to listen on localhost:8080?</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Postgres Collation on x" href="https://x.com/intent/tweet/?text=Postgres%20Collation&amp;url=https%3a%2f%2fkhanh1998.github.io%2fposts%2fpostgres-collation%2f&amp;hashtags=postgres%2cdatabase"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Postgres Collation on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fkhanh1998.github.io%2fposts%2fpostgres-collation%2f&amp;title=Postgres%20Collation&amp;summary=Postgres%20Collation&amp;source=https%3a%2f%2fkhanh1998.github.io%2fposts%2fpostgres-collation%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Postgres Collation on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fkhanh1998.github.io%2fposts%2fpostgres-collation%2f&title=Postgres%20Collation"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Postgres Collation on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fkhanh1998.github.io%2fposts%2fpostgres-collation%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Postgres Collation on whatsapp" href="https://api.whatsapp.com/send?text=Postgres%20Collation%20-%20https%3a%2f%2fkhanh1998.github.io%2fposts%2fpostgres-collation%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Postgres Collation on telegram" href="https://telegram.me/share/url?text=Postgres%20Collation&amp;url=https%3a%2f%2fkhanh1998.github.io%2fposts%2fpostgres-collation%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Postgres Collation on ycombinator" href="https://news.ycombinator.com/submitlink?t=Postgres%20Collation&u=https%3a%2f%2fkhanh1998.github.io%2fposts%2fpostgres-collation%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//khanh1998.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2025 <a href=https://khanh1998.github.io/>Khanh1998</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>